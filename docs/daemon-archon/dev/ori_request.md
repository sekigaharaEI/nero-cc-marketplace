# daemon-archon 原始需求

## 用户原始描述

> 我想按照这个claude code 插件仓库的规范 创建一个与守护进程以及定时任务推送相关的插件，主要就是想让claude code 以观察者（调度员）的身份 操作claude code （此处命名为执行者）进行一个长期任务的执行，并且每隔x分钟（定时）自动检测当前任务的执行状态（通过查看执行者claude code 对应的操作、对话记录、日志），并判断是否需要纠偏，到底是需要自动纠偏（观察者自己纠偏）还是要发送系统级消息，让用户进行介入

## 核心需求拆解

### 需求 1：定时任务管理
- 通过 `/command` 启动定时任务并配置
- 对应需要有命令关闭定时任务

### 需求 2：Archon（执政官）的两种工作模式

#### 模式 2.1：Probe 模式（监控智能体）
- Archon 启动一个子 Claude Code CLI（Probe）执行长期任务
- Archon 持续监控 Probe 的执行状态
- 通过分析 Probe 的对话记录、操作、日志判断状态
- 发现问题时进行**纠偏**（向 Probe 注入指令）或通知用户

**核心特点**：
- Probe 是一个持续运行的会话
- Archon 与 Probe 之间有交互（纠偏）
- 适用于：代码重构、长期开发任务等

#### 模式 2.2：Cron 模式（定时任务）
- 根据用户提示词生成一个 **cron 任务文件**
- 定时触发一个**临时** Claude Code CLI 执行 cron 任务
- 执行完毕后分析结果，判断是否需要通知用户
- 每次执行都是独立的临时对话，不保留上下文

**核心特点**：
- 每次执行都是新的临时会话
- 没有"纠偏"概念，只有"执行 + 分析 + 通知"
- 适用于：定时检查、日志分析、状态巡检等

---

## 两种模式对比

| 维度 | Probe 模式 | Cron 模式 |
|------|-----------|--------------|
| 会话类型 | 持续会话（Probe） | 临时会话（每次新建） |
| 核心动作 | 监控 + 纠偏 | 执行 + 分析 + 通知 |
| 上下文 | Probe 保持上下文 | 无上下文，每次独立 |
| 交互方式 | Archon ↔ Probe 双向 | 单向执行 |
| 适用场景 | 需要 Claude Code 持续执行的长期任务 | 定时巡检/检查 |

---

## 需求对照检查

| 原始需求 | 当前设计是否覆盖 | 备注 |
|---------|----------------|------|
| 通过 /command 启动定时任务 | ✅ 覆盖 | 区分两种模式的启动命令 |
| 关闭定时任务的命令 | ✅ 覆盖 | 区分停止 Probe vs 停止 Cron |
| 模式 2.1：Probe 模式 | ✅ 覆盖 | 设计中的核心流程 |
| 模式 2.2：Cron 模式 | ✅ 覆盖 | 已新增设计 |
| 系统级提示 | ✅ 覆盖 | F6 用户通知功能 |

---

## 需要补充的设计

### 1. Cron 模式设计
- cron 任务文件格式定义
- 定时触发机制
- 临时会话执行流程
- 结果分析与通知逻辑

### 2. 命令体系调整
- `/start-probe <task>`: 启动 Probe 模式任务
- `/start-cron <task>`: 创建并启动 Cron 模式任务
- `/stop-probe <task_id>`: 停止 Probe 任务
- `/stop-cron <task_id>`: 停止 Cron 定时任务
- `/list-tasks`: 列出所有任务（两种模式）

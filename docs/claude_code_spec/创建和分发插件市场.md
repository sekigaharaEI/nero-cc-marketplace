> ## Documentation Index
> Fetch the complete documentation index at: https://code.claude.com/docs/llms.txt
> Use this file to discover all available pages before exploring further.

# 创建和分发插件市场

> 构建和托管插件市场，以在团队和社区中分发 Claude Code 扩展。

插件市场是一个目录，让您可以将插件分发给他人。市场提供集中式发现、版本跟踪、自动更新以及对多种源类型（git 存储库、本地路径等）的支持。本指南展示了如何创建自己的市场，以与您的团队或社区共享插件。

想要从现有市场安装插件？请参阅[发现和安装预构建插件](/zh-CN/discover-plugins)。

## 概述

创建和分发市场涉及：

1. **创建插件**：使用命令、代理、钩子、MCP 服务器或 LSP 服务器构建一个或多个插件。本指南假设您已经有要分发的插件；有关如何创建插件的详细信息，请参阅[创建插件](/zh-CN/plugins)。
2. **创建市场文件**：定义一个 `marketplace.json`，列出您的插件及其位置（请参阅[创建市场文件](#create-the-marketplace-file)）。
3. **托管市场**：推送到 GitHub、GitLab 或其他 git 主机（请参阅[托管和分发市场](#host-and-distribute-marketplaces)）。
4. **与用户共享**：用户使用 `/plugin marketplace add` 添加您的市场并安装单个插件（请参阅[发现和安装插件](/zh-CN/discover-plugins)）。

一旦您的市场上线，您可以通过推送更改到您的存储库来更新它。用户使用 `/plugin marketplace update` 刷新其本地副本。

## 演练：创建本地市场

此示例创建一个包含一个插件的市场：用于代码审查的 `/review` 技能。您将创建目录结构、添加技能、创建插件清单和市场目录，然后安装和测试它。

<Steps>
  <Step title="创建目录结构">
    ```bash  theme={null}
    mkdir -p my-marketplace/.claude-plugin
    mkdir -p my-marketplace/plugins/review-plugin/.claude-plugin
    mkdir -p my-marketplace/plugins/review-plugin/skills/review
    ```
  </Step>

  <Step title="创建技能">
    创建一个 `SKILL.md` 文件，定义 `/review` 技能的功能。

    ```markdown my-marketplace/plugins/review-plugin/skills/review/SKILL.md theme={null}
    ---
    description: 审查代码中的错误、安全性和性能问题
    disable-model-invocation: true
    ---

    审查我选择的代码或最近的更改，查找：
    - 潜在的错误或边界情况
    - 安全问题
    - 性能问题
    - 可读性改进

    简洁明了且可操作。
    ```
  </Step>

  <Step title="创建插件清单">
    创建一个 `plugin.json` 文件，描述插件。清单位于 `.claude-plugin/` 目录中。

    ```json my-marketplace/plugins/review-plugin/.claude-plugin/plugin.json theme={null}
    {
      "name": "review-plugin",
      "description": "为快速代码审查添加 /review 技能",
      "version": "1.0.0"
    }
    ```
  </Step>

  <Step title="创建市场文件">
    创建列出您的插件的市场目录。

    ```json my-marketplace/.claude-plugin/marketplace.json theme={null}
    {
      "name": "my-plugins",
      "owner": {
        "name": "Your Name"
      },
      "plugins": [
        {
          "name": "review-plugin",
          "source": "./plugins/review-plugin",
          "description": "为快速代码审查添加 /review 技能"
        }
      ]
    }
    ```
  </Step>

  <Step title="添加和安装">
    添加市场并安装插件。

    ```shell  theme={null}
    /plugin marketplace add ./my-marketplace
    /plugin install review-plugin@my-plugins
    ```
  </Step>

  <Step title="尝试一下">
    在编辑器中选择一些代码并运行您的新命令。

    ```shell  theme={null}
    /review
    ```
  </Step>
</Steps>

要了解有关插件可以执行的操作的更多信息，包括钩子、代理、MCP 服务器和 LSP 服务器，请参阅[插件](/zh-CN/plugins)。

<Note>
  **插件如何安装**：当用户安装插件时，Claude Code 会将插件目录复制到缓存位置。这意味着插件无法使用 `../shared-utils` 之类的路径引用其目录外的文件，因为这些文件不会被复制。

  如果您需要在插件之间共享文件，请使用符号链接（在复制期间会被跟踪）或重新构造您的市场，使共享目录位于插件源路径内。有关详细信息，请参阅[插件缓存和文件解析](/zh-CN/plugins-reference#plugin-caching-and-file-resolution)。
</Note>

## 创建市场文件

在您的存储库根目录中创建 `.claude-plugin/marketplace.json`。此文件定义您的市场名称、所有者信息以及包含其源的插件列表。

每个插件条目至少需要一个 `name` 和 `source`（从何处获取）。有关所有可用字段，请参阅下面的[完整架构](#marketplace-schema)。

```json  theme={null}
{
  "name": "company-tools",
  "owner": {
    "name": "DevTools Team",
    "email": "devtools@example.com"
  },
  "plugins": [
    {
      "name": "code-formatter",
      "source": "./plugins/formatter",
      "description": "保存时自动代码格式化",
      "version": "2.1.0",
      "author": {
        "name": "DevTools Team"
      }
    },
    {
      "name": "deployment-tools",
      "source": {
        "source": "github",
        "repo": "company/deploy-plugin"
      },
      "description": "部署自动化工具"
    }
  ]
}
```

## 市场架构

### 必需字段

| 字段        | 类型     | 描述                                                                                         | 示例             |
| :-------- | :----- | :----------------------------------------------------------------------------------------- | :------------- |
| `name`    | string | 市场标识符（kebab-case，无空格）。这是面向公众的：用户在安装插件时会看到它（例如，`/plugin install my-tool@your-marketplace`）。 | `"acme-tools"` |
| `owner`   | object | 市场维护者信息（[见下面的字段](#owner-fields)）                                                           |                |
| `plugins` | array  | 可用插件列表                                                                                     | 见下文            |

<Note>
  **保留名称**：以下市场名称为 Anthropic 官方使用保留，第三方市场无法使用：`claude-code-marketplace`、`claude-code-plugins`、`claude-plugins-official`、`anthropic-marketplace`、`anthropic-plugins`、`agent-skills`、`life-sciences`。模仿官方市场的名称（如 `official-claude-plugins` 或 `anthropic-tools-v2`）也被阻止。
</Note>

### 所有者字段

| 字段      | 类型     | 必需 | 描述         |
| :------ | :----- | :- | :--------- |
| `name`  | string | 是  | 维护者或团队的名称  |
| `email` | string | 否  | 维护者的联系电子邮件 |

### 可选元数据

| 字段                     | 类型     | 描述                                                                                                   |
| :--------------------- | :----- | :--------------------------------------------------------------------------------------------------- |
| `metadata.description` | string | 简短的市场描述                                                                                              |
| `metadata.version`     | string | 市场版本                                                                                                 |
| `metadata.pluginRoot`  | string | 前置到相对插件源路径的基目录（例如，`"./plugins"` 让您可以写 `"source": "formatter"` 而不是 `"source": "./plugins/formatter"`） |

## 插件条目

`plugins` 数组中的每个插件条目描述一个插件及其位置。您可以包含[插件清单架构](/zh-CN/plugins-reference#plugin-manifest-schema)中的任何字段（如 `description`、`version`、`author`、`commands`、`hooks` 等），加上这些市场特定字段：`source`、`category`、`tags` 和 `strict`。

### 必需字段

| 字段       | 类型             | 描述                                                                                    |
| :------- | :------------- | :------------------------------------------------------------------------------------ |
| `name`   | string         | 插件标识符（kebab-case，无空格）。这是面向公众的：用户在安装时会看到它（例如，`/plugin install my-plugin@marketplace`）。 |
| `source` | string\|object | 从何处获取插件（见下面的[插件源](#plugin-sources)）                                                   |

### 可选插件字段

**标准元数据字段：**

| 字段            | 类型      | 描述                                                                                                                                                                              |
| :------------ | :------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `description` | string  | 简短的插件描述                                                                                                                                                                         |
| `version`     | string  | 插件版本                                                                                                                                                                            |
| `author`      | object  | 插件作者信息（`name` 必需，`email` 可选）                                                                                                                                                    |
| `homepage`    | string  | 插件主页或文档 URL                                                                                                                                                                     |
| `repository`  | string  | 源代码存储库 URL                                                                                                                                                                      |
| `license`     | string  | SPDX 许可证标识符（例如，MIT、Apache-2.0）                                                                                                                                                  |
| `keywords`    | array   | 用于插件发现和分类的标签                                                                                                                                                                    |
| `category`    | string  | 用于组织的插件类别                                                                                                                                                                       |
| `tags`        | array   | 用于可搜索性的标签                                                                                                                                                                       |
| `strict`      | boolean | 控制插件是否需要自己的 `plugin.json` 文件。当为 `true`（默认值）时，插件源必须包含 `plugin.json`，您在此处市场条目中添加的任何字段都会与其合并。当为 `false` 时，插件不需要自己的 `plugin.json`；市场条目本身定义了关于插件的所有内容。当您想完全在市场文件中定义简单插件时，使用 `false`。 |

**组件配置字段：**

| 字段           | 类型             | 描述                   |
| :----------- | :------------- | :------------------- |
| `commands`   | string\|array  | 命令文件或目录的自定义路径        |
| `agents`     | string\|array  | 代理文件的自定义路径           |
| `hooks`      | string\|object | 自定义钩子配置或钩子文件的路径      |
| `mcpServers` | string\|object | MCP 服务器配置或 MCP 配置的路径 |
| `lspServers` | string\|object | LSP 服务器配置或 LSP 配置的路径 |

## 插件源

### 相对路径

对于同一存储库中的插件：

```json  theme={null}
{
  "name": "my-plugin",
  "source": "./plugins/my-plugin"
}
```

<Note>
  相对路径仅在用户通过 Git（GitHub、GitLab 或 git URL）添加您的市场时有效。如果用户通过直接 URL 添加您的市场到 `marketplace.json` 文件，相对路径将无法正确解析。对于基于 URL 的分发，请改用 GitHub、npm 或 git URL 源。有关详细信息，请参阅[故障排除](#plugins-with-relative-paths-fail-in-url-based-marketplaces)。
</Note>

### GitHub 存储库

```json  theme={null}
{
  "name": "github-plugin",
  "source": {
    "source": "github",
    "repo": "owner/plugin-repo"
  }
}
```

### Git 存储库

```json  theme={null}
{
  "name": "git-plugin",
  "source": {
    "source": "url",
    "url": "https://gitlab.com/team/plugin.git"
  }
}
```

### 高级插件条目

此示例显示了使用许多可选字段的插件条目，包括命令、代理、钩子和 MCP 服务器的自定义路径：

```json  theme={null}
{
  "name": "enterprise-tools",
  "source": {
    "source": "github",
    "repo": "company/enterprise-plugin"
  },
  "description": "企业工作流自动化工具",
  "version": "2.1.0",
  "author": {
    "name": "Enterprise Team",
    "email": "enterprise@example.com"
  },
  "homepage": "https://docs.example.com/plugins/enterprise-tools",
  "repository": "https://github.com/company/enterprise-plugin",
  "license": "MIT",
  "keywords": ["enterprise", "workflow", "automation"],
  "category": "productivity",
  "commands": [
    "./commands/core/",
    "./commands/enterprise/",
    "./commands/experimental/preview.md"
  ],
  "agents": ["./agents/security-reviewer.md", "./agents/compliance-checker.md"],
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "${CLAUDE_PLUGIN_ROOT}/scripts/validate.sh"
          }
        ]
      }
    ]
  },
  "mcpServers": {
    "enterprise-db": {
      "command": "${CLAUDE_PLUGIN_ROOT}/servers/db-server",
      "args": ["--config", "${CLAUDE_PLUGIN_ROOT}/config.json"]
    }
  },
  "strict": false
}
```

需要注意的关键事项：

* **`commands` 和 `agents`**：您可以指定多个目录或单个文件。路径相对于插件根目录。
* **`${CLAUDE_PLUGIN_ROOT}`**：在钩子和 MCP 服务器配置中使用此变量来引用插件安装目录中的文件。这是必要的，因为插件在安装时被复制到缓存位置。
* **`strict: false`**：由于设置为 false，插件不需要自己的 `plugin.json`。市场条目定义了所有内容。

## 托管和分发市场

### 在 GitHub 上托管（推荐）

GitHub 提供最简单的分发方法：

1. **创建存储库**：为您的市场设置一个新存储库
2. **添加市场文件**：使用您的插件定义创建 `.claude-plugin/marketplace.json`
3. **与团队共享**：用户使用 `/plugin marketplace add owner/repo` 添加您的市场

**优势**：内置版本控制、问题跟踪和团队协作功能。

### 在其他 git 服务上托管

任何 git 托管服务都可以工作，例如 GitLab、Bitbucket 和自托管服务器。用户使用完整的存储库 URL 添加：

```shell  theme={null}
/plugin marketplace add https://gitlab.com/company/plugins.git
```

### 私有存储库

Claude Code 支持从私有存储库安装插件。在您的环境中设置适当的身份验证令牌，Claude Code 将在需要身份验证时使用它。

| 提供商       | 环境变量                        | 注释                    |
| :-------- | :-------------------------- | :-------------------- |
| GitHub    | `GITHUB_TOKEN` 或 `GH_TOKEN` | 个人访问令牌或 GitHub App 令牌 |
| GitLab    | `GITLAB_TOKEN` 或 `GL_TOKEN` | 个人访问令牌或项目令牌           |
| Bitbucket | `BITBUCKET_TOKEN`           | 应用密码或存储库访问令牌          |

在您的 shell 配置中设置令牌（例如，`.bashrc`、`.zshrc`）或在运行 Claude Code 时传递它：

```bash  theme={null}
export GITHUB_TOKEN=ghp_xxxxxxxxxxxxxxxxxxxx
```

身份验证令牌仅在存储库需要身份验证时使用。公共存储库无需任何配置的令牌即可工作，即使环境中存在令牌。

<Note>
  对于 CI/CD 环境，将令牌配置为秘密环境变量。GitHub Actions 自动为同一组织中的存储库提供 `GITHUB_TOKEN`。
</Note>

### 分发前在本地测试

在共享之前在本地测试您的市场：

```shell  theme={null}
/plugin marketplace add ./my-local-marketplace
/plugin install test-plugin@my-local-marketplace
```

有关完整的添加命令范围（GitHub、Git URL、本地路径、远程 URL），请参阅[添加市场](/zh-CN/discover-plugins#add-marketplaces)。

### 为您的团队要求市场

您可以配置您的存储库，以便当团队成员信任项目文件夹时，他们会自动被提示安装您的市场。将您的市场添加到 `.claude/settings.json`：

```json  theme={null}
{
  "extraKnownMarketplaces": {
    "company-tools": {
      "source": {
        "source": "github",
        "repo": "your-org/claude-plugins"
      }
    }
  }
}
```

您还可以指定默认应启用哪些插件：

```json  theme={null}
{
  "enabledPlugins": {
    "code-formatter@company-tools": true,
    "deployment-tools@company-tools": true
  }
}
```

有关完整的配置选项，请参阅[插件设置](/zh-CN/settings#plugin-settings)。

### 托管市场限制

对于需要严格控制插件源的组织，管理员可以使用托管设置中的 [`strictKnownMarketplaces`](/zh-CN/settings#strictknownmarketplaces) 设置来限制用户允许添加哪些插件市场。

当在托管设置中配置 `strictKnownMarketplaces` 时，限制行为取决于该值：

| 值        | 行为                 |
| -------- | ------------------ |
| 未定义（默认）  | 无限制。用户可以添加任何市场     |
| 空数组 `[]` | 完全锁定。用户无法添加任何新市场   |
| 源列表      | 用户只能添加与允许列表完全匹配的市场 |

#### 常见配置

禁用所有市场添加：

```json  theme={null}
{
  "strictKnownMarketplaces": []
}
```

仅允许特定市场：

```json  theme={null}
{
  "strictKnownMarketplaces": [
    {
      "source": "github",
      "repo": "acme-corp/approved-plugins"
    },
    {
      "source": "github",
      "repo": "acme-corp/security-tools",
      "ref": "v2.0"
    },
    {
      "source": "url",
      "url": "https://plugins.example.com/marketplace.json"
    }
  ]
}
```

#### 限制如何工作

限制在插件安装过程的早期进行验证，在任何网络请求或文件系统操作之前。这可以防止未授权的市场访问尝试。

允许列表使用精确匹配。为了允许市场，所有指定的字段必须完全匹配：

* 对于 GitHub 源：`repo` 是必需的，如果在允许列表中指定，`ref` 或 `path` 也必须匹配
* 对于 URL 源：完整 URL 必须完全匹配

因为 `strictKnownMarketplaces` 在[托管设置](/zh-CN/settings#settings-files)中设置，个别用户和项目配置无法覆盖这些限制。

有关完整的配置详细信息，包括所有支持的源类型和与 `extraKnownMarketplaces` 的比较，请参阅 [strictKnownMarketplaces 参考](/zh-CN/settings#strictknownmarketplaces)。

## 验证和测试

在共享之前测试您的市场。

验证您的市场 JSON 语法：

```bash  theme={null}
claude plugin validate .
```

或从 Claude Code 中：

```shell  theme={null}
/plugin validate .
```

添加市场进行测试：

```shell  theme={null}
/plugin marketplace add ./path/to/marketplace
```

安装测试插件以验证一切正常：

```shell  theme={null}
/plugin install test-plugin@marketplace-name
```

有关完整的插件测试工作流，请参阅[在本地测试您的插件](/zh-CN/plugins#test-your-plugins-locally)。有关技术故障排除，请参阅[插件参考](/zh-CN/plugins-reference)。

## 故障排除

### 市场未加载

**症状**：无法添加市场或看不到其中的插件

**解决方案**：

* 验证市场 URL 是否可访问
* 检查 `.claude-plugin/marketplace.json` 是否存在于指定路径
* 使用 `claude plugin validate` 或 `/plugin validate` 确保 JSON 语法有效
* 对于私有存储库，确认您有访问权限

### 市场验证错误

从您的市场目录运行 `claude plugin validate .` 或 `/plugin validate .` 以检查问题。常见错误：

| 错误                                                | 原因          | 解决方案                                       |
| :------------------------------------------------ | :---------- | :----------------------------------------- |
| `File not found: .claude-plugin/marketplace.json` | 缺少清单        | 使用必需字段创建 `.claude-plugin/marketplace.json` |
| `Invalid JSON syntax: Unexpected token...`        | JSON 语法错误   | 检查缺少的逗号、多余的逗号或未引用的字符串                      |
| `Duplicate plugin name "x" found in marketplace`  | 两个插件共享相同的名称 | 为每个插件提供唯一的 `name` 值                        |
| `plugins[0].source: Path traversal not allowed`   | 源路径包含 `..`  | 使用相对于市场根目录的路径，不包含 `..`                     |

**警告**（非阻止性）：

* `Marketplace has no plugins defined`：将至少一个插件添加到 `plugins` 数组
* `No marketplace description provided`：添加 `metadata.description` 以帮助用户了解您的市场
* `Plugin "x" uses npm source which is not yet fully implemented`：改用 `github` 或本地路径源

### 插件安装失败

**症状**：市场出现但插件安装失败

**解决方案**：

* 验证插件源 URL 是否可访问
* 检查插件目录是否包含必需的文件
* 对于 GitHub 源，确保存储库是公开的或您有访问权限
* 通过手动克隆/下载来测试插件源

### 私有存储库身份验证失败

**症状**：从私有存储库安装插件时出现身份验证错误，即使配置了令牌

**解决方案**：

* 验证您的令牌是否在当前 shell 会话中设置：`echo $GITHUB_TOKEN`
* 检查令牌是否具有所需的权限（对存储库的读取访问权限）
* 对于 GitHub，确保令牌对私有存储库具有 `repo` 范围
* 对于 GitLab，确保令牌至少具有 `read_repository` 范围
* 验证令牌是否已过期
* 如果使用多个 git 提供商，确保您为正确的提供商设置了令牌

### 相对路径插件在基于 URL 的市场中失败

**症状**：通过 URL（如 `https://example.com/marketplace.json`）添加了市场，但具有相对路径源（如 `"./plugins/my-plugin"`）的插件安装失败，出现"路径未找到"错误。

**原因**：基于 URL 的市场仅下载 `marketplace.json` 文件本身。它们不从服务器下载插件文件。市场条目中的相对路径引用远程服务器上未下载的文件。

**解决方案**：

* **使用外部源**：将插件条目更改为使用 GitHub、npm 或 git URL 源，而不是相对路径：
  ```json  theme={null}
  { "name": "my-plugin", "source": { "source": "github", "repo": "owner/repo" } }
  ```
* **使用基于 Git 的市场**：在 Git 存储库中托管您的市场并使用 git URL 添加它。基于 Git 的市场克隆整个存储库，使相对路径正常工作。

### 安装后找不到文件

**症状**：插件安装但对文件的引用失败，特别是插件目录外的文件

**原因**：插件被复制到缓存目录而不是就地使用。引用插件目录外文件的路径（如 `../shared-utils`）将无法工作，因为这些文件不会被复制。

**解决方案**：有关包括符号链接和目录重组的解决方法，请参阅[插件缓存和文件解析](/zh-CN/plugins-reference#plugin-caching-and-file-resolution)。

有关其他调试工具和常见问题，请参阅[调试和开发工具](/zh-CN/plugins-reference#debugging-and-development-tools)。

## 另请参阅

* [发现和安装预构建插件](/zh-CN/discover-plugins) - 从现有市场安装插件
* [插件](/zh-CN/plugins) - 创建您自己的插件
* [插件参考](/zh-CN/plugins-reference) - 完整的技术规范和架构
* [插件设置](/zh-CN/settings#plugin-settings) - 插件配置选项
* [strictKnownMarketplaces 参考](/zh-CN/settings#strictknownmarketplaces) - 托管市场限制

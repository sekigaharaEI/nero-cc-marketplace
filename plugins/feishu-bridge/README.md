# Feishu Bridge - é£ä¹¦æ¶ˆæ¯æ¡¥

é€šè¿‡é£ä¹¦å¼€æ”¾å¹³å°å‘é€ç§èŠé€šçŸ¥æ¶ˆæ¯çš„ Claude Code æ’ä»¶ã€‚æ”¯æŒæ–‡æœ¬æ¶ˆæ¯å‘é€ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶åŒæ¨¡å¼å‡­è¯ç®¡ç†ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **ç®€å•æ˜“ç”¨**: ä¸€è¡Œå‘½ä»¤å‘é€é£ä¹¦é€šçŸ¥
- ğŸ” **çµæ´»é…ç½®**: æ”¯æŒç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ä¸¤ç§æ–¹å¼
- ğŸ’¬ **ç§èŠé€šçŸ¥**: å‘ä¸ªäººå‘é€æ–‡æœ¬æ¶ˆæ¯
- ğŸ”„ **è‡ªåŠ¨è°ƒç”¨**: AI å¯æ ¹æ®éœ€è¦è‡ªåŠ¨å‘é€é€šçŸ¥
- ğŸ›¡ï¸ **å®‰å…¨å¯é **: Token è‡ªåŠ¨ç¼“å­˜å’Œåˆ·æ–°

## å®‰è£…

```bash
/plugin install feishu-bridge@nero-cc-marketplace
```

## å¿«é€Ÿå¼€å§‹

### 1. é…ç½®é£ä¹¦åº”ç”¨

é¦–æ¬¡ä½¿ç”¨éœ€è¦é…ç½®é£ä¹¦åº”ç”¨å‡­è¯ã€‚è¿è¡Œäº¤äº’å¼é…ç½®å‘å¯¼:

```bash
/feishu-setup
```

é…ç½®å‘å¯¼å°†å¼•å¯¼ä½ å®Œæˆä»¥ä¸‹æ­¥éª¤:
1. æ£€æŸ¥ä¾èµ–ç¯å¢ƒ
2. åˆ›å»ºé£ä¹¦ä¼ä¸šè‡ªå»ºåº”ç”¨
3. é…ç½®åº”ç”¨æƒé™å¹¶å‘å¸ƒ
4. è·å– App ID å’Œ App Secret
5. é€‰æ‹©é…ç½®æ–¹å¼ï¼ˆé…ç½®æ–‡ä»¶/ç¯å¢ƒå˜é‡ï¼‰
6. è·å–æ¥æ”¶è€… Open ID
7. æµ‹è¯•å‘é€æ¶ˆæ¯
8. é…ç½®å®Œæˆ

**æ–°ç‰ˆç‰¹æ€§**: v1.0.1 æä¾›äº†å®Œå…¨äº¤äº’å¼çš„é…ç½®æµç¨‹ï¼Œæ¯ä¸€æ­¥éƒ½æœ‰æ˜ç¡®çš„ç½‘å€é“¾æ¥å’Œé€‰é¡¹å¼•å¯¼ã€‚

### 2. å‘é€æµ‹è¯•æ¶ˆæ¯

é…ç½®å®Œæˆå,æµ‹è¯•å‘é€æ¶ˆæ¯:

```bash
python3 ~/.claude/plugins/feishu-bridge/scripts/feishu_cli.py send \
  --to ou_xxx \
  --message "æµ‹è¯•æ¶ˆæ¯"
```

### 3. AI è‡ªåŠ¨è°ƒç”¨

é…ç½®å®Œæˆå,AI å¯ä»¥æ ¹æ®éœ€è¦è‡ªåŠ¨å‘é€é£ä¹¦é€šçŸ¥:

```
ç”¨æˆ·: "ä»£ç å®¡æŸ¥å®Œæˆå,é€šè¿‡é£ä¹¦é€šçŸ¥æˆ‘"
AI: [æ‰§è¡Œå®¡æŸ¥...]
    [å‘é€é£ä¹¦é€šçŸ¥: "ä»£ç å®¡æŸ¥å·²å®Œæˆ"]
```

## Skills

### feishu-send-notification

æ•™ AI å¦‚ä½•å‘é€é£ä¹¦é€šçŸ¥æ¶ˆæ¯ã€‚

**ä½¿ç”¨åœºæ™¯:**
- ä»»åŠ¡å®Œæˆé€šçŸ¥
- çŠ¶æ€åŒæ­¥æé†’
- å·¥ä½œæµè¿›åº¦æ›´æ–°

**ç¤ºä¾‹:**
```bash
python3 ${CLAUDE_PLUGIN_ROOT}/scripts/feishu_cli.py send \
  --to ou_xxx \
  --message "éƒ¨ç½²å®Œæˆ"
```

### feishu-setup

äº¤äº’å¼é…ç½®å‘å¯¼ï¼ˆä»…ç”¨æˆ·æ‰‹åŠ¨è°ƒç”¨ï¼‰ã€‚

**è°ƒç”¨æ–¹å¼:**
```bash
/feishu-setup
```

**åŠŸèƒ½:**
- åˆ†æ­¥å¼•å¯¼å®Œæˆé£ä¹¦åº”ç”¨åˆ›å»ºå’Œé…ç½®
- æä¾›æ˜ç¡®çš„ç½‘å€é“¾æ¥å’Œæ“ä½œæŒ‡å¼•
- ä½¿ç”¨é€‰é¡¹å¼äº¤äº’ï¼Œé™ä½é…ç½®å‡ºé”™ç‡
- è‡ªåŠ¨éªŒè¯é…ç½®å¹¶å‘é€æµ‹è¯•æ¶ˆæ¯

**æ–°ç‰ˆç‰¹æ€§ (v1.0.1):**
- å®Œå…¨é‡å†™çš„äº¤äº’å¼é…ç½®æµç¨‹
- æ¯ä¸€æ­¥éƒ½æœ‰æ˜ç¡®çš„é£ä¹¦å¼€æ”¾å¹³å°é“¾æ¥
- ä½¿ç”¨ AskUserQuestion å·¥å…·å¼•å¯¼ç”¨æˆ·é€‰æ‹©
- è¯¦ç»†çš„æ•…éšœæ’æŸ¥æŒ‡å—

## é…ç½®æ–¹å¼

ä½¿ç”¨ `/feishu-setup` äº¤äº’å¼é…ç½®å‘å¯¼å®Œæˆé…ç½®ã€‚

### é…ç½®æ–‡ä»¶

ä½¿ç”¨ CLI å·¥å…·è®¾ç½®:

```bash
python3 ~/.claude/plugins/feishu-bridge/scripts/feishu_cli.py config set \
  --app-id "cli_xxx" \
  --app-secret "xxx" \
  --domain "feishu" \
  --recipient-open-id "ou_xxx"
```

**å‚æ•°è¯´æ˜**ï¼š
- `--app-id`: é£ä¹¦åº”ç”¨ IDï¼ˆå¿…éœ€ï¼‰
- `--app-secret`: é£ä¹¦åº”ç”¨å¯†é’¥ï¼ˆå¿…éœ€ï¼‰
- `--domain`: é£ä¹¦åŸŸåï¼Œé»˜è®¤ feishuï¼ˆå¿…éœ€ï¼‰
- `--recipient-open-id`: æ¥æ”¶è€… Open IDï¼ˆå¯é€‰ï¼Œç”¨äºé’©å­è‡ªåŠ¨é€šçŸ¥ï¼‰

é…ç½®ä¿å­˜åœ¨ `~/.feishu-bridge/config.json`ï¼Œæ–‡ä»¶æƒé™è‡ªåŠ¨è®¾ç½®ä¸º 600ã€‚

**æ³¨æ„**: æœ¬æ’ä»¶ä»…æ”¯æŒé£ä¹¦ä¸­å›½ç‰ˆï¼Œä¸æ”¯æŒ Lark å›½é™…ç‰ˆã€‚

## Hooks (é’©å­)

æ’ä»¶æä¾›ä¸¤ä¸ªè‡ªåŠ¨åŒ–é’©å­ï¼Œåœ¨å…³é”®äº‹ä»¶æ—¶å‘é€é£ä¹¦é€šçŸ¥ï¼š

### 1. Notification Hook - ç­‰å¾…æé†’

å½“ Claude Code éœ€è¦ç”¨æˆ·äº¤äº’æ—¶è‡ªåŠ¨å‘é€é£ä¹¦é€šçŸ¥ï¼š

**è§¦å‘æ¡ä»¶:**
- `permission_prompt` - æƒé™è¯·æ±‚ç­‰å¾…ç¡®è®¤
- `idle_prompt` - ç©ºé—²è¶…è¿‡ 60 ç§’ç­‰å¾…è¾“å…¥
- `elicitation_dialog` - éœ€è¦ç”¨æˆ·æä¾›ä¿¡æ¯

**é…ç½®è¦æ±‚:**

åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æ¥æ”¶è€… Open IDï¼š

```bash
python3 ~/.claude/plugins/feishu-bridge/scripts/feishu_cli.py config set \
  --app-id "cli_xxx" \
  --app-secret "xxx" \
  --domain "feishu" \
  --recipient-open-id "ou_xxx"
```

æˆ–æ‰‹åŠ¨ç¼–è¾‘ `~/.feishu-bridge/config.json`ï¼š

```json
{
  "app_id": "cli_xxx",
  "app_secret": "xxx",
  "domain": "feishu",
  "recipient_open_id": "ou_xxx"
}
```

**é€šçŸ¥ç¤ºä¾‹:**
- ğŸ”” Claude Code æ­£åœ¨ç­‰å¾…æ‚¨çš„æƒé™ç¡®è®¤
- â° Claude Code æ­£åœ¨ç­‰å¾…æ‚¨çš„å›å¤
- â“ Claude Code éœ€è¦æ‚¨çš„è¾“å…¥

### 2. Stop Hook - ä»»åŠ¡å®Œæˆæ±‡æŠ¥

å½“ Claude Code ä¼šè¯ç»“æŸæ—¶ï¼Œè‡ªåŠ¨å‘é€ç®€å•çš„ä»»åŠ¡å®Œæˆé€šçŸ¥ã€‚

**åŠŸèƒ½ç‰¹æ€§:**
- ğŸ“‹ å‘é€ä»»åŠ¡å®Œæˆæé†’
- âœ… ç®€æ´æ˜äº†çš„é€šçŸ¥æ¶ˆæ¯

**é…ç½®è¦æ±‚:**

åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æ¥æ”¶è€… Open IDï¼š

```bash
python3 ~/.claude/plugins/feishu-bridge/scripts/feishu_cli.py config set \
  --app-id "cli_xxx" \
  --app-secret "xxx" \
  --domain "feishu" \
  --recipient-open-id "ou_xxx"
```

æˆ–æ‰‹åŠ¨ç¼–è¾‘ `~/.feishu-bridge/config.json`ï¼š

```json
{
  "app_id": "cli_xxx",
  "app_secret": "xxx",
  "domain": "feishu",
  "recipient_open_id": "ou_xxx"
}
```

**é€šçŸ¥ç¤ºä¾‹:**

```
ğŸ“‹ ä»»åŠ¡å®Œæˆé€šçŸ¥

âœ… Claude Code ä»»åŠ¡å·²å®Œæˆï¼Œè¯·æŸ¥çœ‹çŠ¶æ€ã€‚
```

**å·¥ä½œåŸç†:**

Stop Hook ä½¿ç”¨å‘½ä»¤å¼é’©å­ï¼ˆCommand-based Hookï¼‰ï¼Œå½“ Claude Code å®Œæˆä»»åŠ¡æ—¶ï¼š
1. æ£€æŸ¥é£ä¹¦é…ç½®æ˜¯å¦å­˜åœ¨
2. æ£€æŸ¥æ˜¯å¦é…ç½®äº†æ¥æ”¶è€… Open ID
3. é€šè¿‡é£ä¹¦ CLI å‘é€ç®€å•çš„ä»»åŠ¡å®Œæˆé€šçŸ¥
4. å¦‚æœæœªé…ç½®é£ä¹¦æˆ–æ¥æ”¶è€…ï¼Œé™é»˜è·³è¿‡

### å¯ç”¨ Hooks

Hooks åœ¨æ’ä»¶å®‰è£…åè‡ªåŠ¨å¯ç”¨ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š

```bash
/hooks
```

### ç¦ç”¨ Hooks

å¦‚æœä¸éœ€è¦è‡ªåŠ¨é€šçŸ¥ï¼Œå¯ä»¥åœ¨é¡¹ç›®çš„ `.claude/settings.local.json` ä¸­ç¦ç”¨ï¼š

```json
{
  "hooks": {
    "Notification": [],
    "Stop": []
  }
}
```

## CLI å‘½ä»¤

### å‘é€æ¶ˆæ¯

```bash
python3 feishu_cli.py send --to <open_id> --message "æ¶ˆæ¯å†…å®¹"
```

### æŸ¥çœ‹é…ç½®

```bash
python3 feishu_cli.py config show
```

### è®¾ç½®é…ç½®

```bash
python3 feishu_cli.py config set \
  --app-id "cli_xxx" \
  --app-secret "xxx" \
  --domain "feishu"
```

## é£ä¹¦åº”ç”¨é…ç½®

### å¿…éœ€æƒé™

åœ¨é£ä¹¦å¼€æ”¾å¹³å°ä¸ºåº”ç”¨æ·»åŠ ä»¥ä¸‹æƒé™:

- `im:message` - è·å–ä¸å‘é€å•èŠã€ç¾¤ç»„æ¶ˆæ¯
- `im:message:send_as_bot` - ä»¥åº”ç”¨çš„èº«ä»½å‘æ¶ˆæ¯

### è·å–ç”¨æˆ· Open ID

**æ–¹æ³• 1: é€šè¿‡é£ä¹¦ç®¡ç†åå°ï¼ˆæ¨èï¼‰**

ğŸ”— **é£ä¹¦ç®¡ç†åå°**: https://feishu.cn/admin

1. ç™»å½•é£ä¹¦ç®¡ç†åå°
2. ç‚¹å‡»å·¦ä¾§èœå• **"é€šè®¯å½•"**
3. æ‰¾åˆ°ç›®æ ‡ç”¨æˆ·
4. ç‚¹å‡»ç”¨æˆ·åï¼Œè¿›å…¥ç”¨æˆ·è¯¦æƒ…é¡µ
5. å¤åˆ¶ç”¨æˆ·çš„ Open ID (æ ¼å¼: `ou_xxxxxxxxxx`)

**æ–¹æ³• 2: é€šè¿‡é£ä¹¦å¼€æ”¾å¹³å°**

ğŸ”— **äº‹ä»¶è®¢é˜…**: https://open.feishu.cn/app

1. é…ç½®äº‹ä»¶è®¢é˜…ï¼ˆéœ€è¦å…¬ç½‘å¯è®¿é—®çš„å›è°ƒåœ°å€ï¼‰
2. è®¢é˜… `im.message.receive_v1` äº‹ä»¶
3. åœ¨é£ä¹¦å®¢æˆ·ç«¯ä¸­ç»™åº”ç”¨å‘é€æ¶ˆæ¯
4. åœ¨äº‹ä»¶è®¢é˜…æ—¥å¿—ä¸­æŸ¥çœ‹ `sender.sender_id.open_id`

## æ•…éšœæ’æŸ¥

### é”™è¯¯: "æœªæ‰¾åˆ°é…ç½®"

**è§£å†³**: è¿è¡Œ `/feishu-setup` å®Œæˆé…ç½®

### é”™è¯¯: "Failed to get token"

**åŸå› **: App ID æˆ– App Secret é”™è¯¯

**è§£å†³**: æ£€æŸ¥ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶ä¸­çš„å‡­è¯æ˜¯å¦æ­£ç¡®

### é”™è¯¯: "Permission denied"

**åŸå› **: åº”ç”¨ç¼ºå°‘å¿…è¦æƒé™

**è§£å†³**:
1. åœ¨é£ä¹¦å¼€æ”¾å¹³å°æ·»åŠ  `im:message` æƒé™
2. é‡æ–°å‘å¸ƒåº”ç”¨ç‰ˆæœ¬

### é”™è¯¯: "Invalid receive_id"

**åŸå› **: æ¥æ”¶è€… ID æ ¼å¼é”™è¯¯

**è§£å†³**: ç¡®è®¤ Open ID æ ¼å¼ä¸º `ou_xxx`

## å®‰å…¨å»ºè®®

1. âš ï¸ **ä¸è¦æäº¤ App Secret åˆ°ä»£ç ä»“åº“**
2. ğŸ”’ **ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨å‡­è¯**
3. ğŸ”„ **å®šæœŸæ›´æ–° App Secret**
4. ğŸ›¡ï¸ **æœ€å°æƒé™åŸåˆ™**: åªæ·»åŠ å¿…è¦çš„æƒé™

## æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Claude Code    â”‚
â”‚   (AI Agent)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ è°ƒç”¨ CLI
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ feishu-bridge   â”‚
â”‚   CLI Tool      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ HTTP API
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Feishu      â”‚
â”‚ Open Platform   â”‚
â”‚   (ä¸­å›½ç‰ˆ)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä¾èµ–é¡¹

- Python 3.8+
- requests >= 2.28.0

## é™åˆ¶

- ä»…æ”¯æŒæ–‡æœ¬æ¶ˆæ¯
- ä»…æ”¯æŒä¸ªäººç§èŠ(ä¸æ”¯æŒç¾¤ç»„æ¶ˆæ¯)
- å•å‘å‘é€(ä¸æ¥æ”¶æ¶ˆæ¯)

## ç›¸å…³é“¾æ¥

- [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/)
- [å‘é€æ¶ˆæ¯ API æ–‡æ¡£](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/im-v1/message/create)
- [è·å– tenant_access_token](https://open.feishu.cn/document/ukTMukTMukTM/ukDNz4SO0MjL5QzM/auth-v3/auth/tenant_access_token_internal)

## è®¸å¯è¯

MIT License

## ä½œè€…

Nero

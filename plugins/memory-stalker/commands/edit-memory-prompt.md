# 编辑 Memory Stalker 摘要提示词

编辑 AI 生成摘要时使用的提示词文件。

## 执行步骤

### 1. 查找提示词文件路径

运行路径查找脚本：

```bash
python "${CLAUDE_PROJECT_DIR}/plugins/memory-stalker/scripts/find_prompt_path.py"
```

### 2. 分析查找结果

根据脚本输出的 JSON 结果：

- `found`: 是否找到文件
- `path`: 文件路径
- `source`: 来源 ("cache" = 缓存目录, "installed" = 安装目录, "not_found" = 未找到)

### 3. 根据结果处理

#### 3.1 如果找到文件 (found = true)

展示当前提示词文件信息：

```
## 提示词文件位置

**路径**: {path}
**来源**: {source === "cache" ? "缓存目录（修改后立即生效）" : "插件安装目录"}
```

然后读取并展示当前提示词内容（使用 Read 工具读取 `path` 指向的文件）。

#### 3.2 如果未找到文件 (found = false)

```
## 提示词文件未找到

建议创建路径: {suggested_path}

是否要创建默认提示词文件？
```

使用 AskUserQuestion 询问用户：
- **创建默认提示词**: 在建议路径创建默认提示词文件
- **取消**: 退出

如果用户选择创建，使用 Write 工具在 `suggested_path` 创建默认提示词文件（内容见下方默认模板）。

### 4. 提供编辑选项

使用 AskUserQuestion 询问用户想要进行的操作：

- **查看完整内容**: 展示完整的提示词内容
- **编辑提示词**: 让用户描述想要的修改，然后使用 Edit 工具修改文件
- **恢复默认**: 将提示词恢复为默认内容
- **退出**: 结束编辑

### 5. 编辑提示词

如果用户选择编辑：

1. 询问用户想要修改什么（使用 AskUserQuestion，允许自由输入）
2. 根据用户的描述，使用 Edit 工具修改提示词文件
3. 展示修改后的内容
4. 询问是否继续编辑或退出

### 6. 恢复默认

如果用户选择恢复默认，使用 Write 工具将提示词文件内容替换为默认模板。

---

## 默认提示词模板

```
你是一个专业的会话记忆提取助手。请分析以下 Claude Code 会话记录，提取关键信息并生成结构化的记忆摘要。

## 输出格式要求

请严格按照以下 Markdown 格式输出（不要包含标题，直接从"任务摘要"开始）：

### 任务摘要
- 任务1：简要描述
- 任务2：简要描述

### 代码变更
| 文件 | 操作 | 说明 |
|------|------|------|
| path/to/file.py | 创建/修改/删除 | 变更说明 |

### 关键决策
- **决策**: 描述
  - **原因**: 为什么做出这个决策

### 用户偏好
- 偏好1
- 偏好2

### 待办/后续
- [ ] 待办事项1
- [ ] 待办事项2

### 重要上下文
{记录任何对未来会话有帮助的上下文信息}

## 提取规则

1. **任务摘要**: 只记录实际完成的任务，最多 5 个
2. **代码变更**: 记录所有文件操作，忽略临时文件
3. **关键决策**: 只记录有长期影响的决策，最多 3 个
4. **用户偏好**: 记录明确表达的偏好和工作习惯，最多 3 条
5. **待办/后续**: 记录未完成的任务和发现的问题
6. **重要上下文**: 记录技术栈、配置、集成信息等

## 注意事项

- 只提取有价值的信息，忽略无关的对话
- 保持简洁，避免冗余
- 使用中文输出
- 不要重复"最后一轮交互"和"当前任务列表"中已有的内容
```

---

## 提示词修改建议

用户可以根据需求调整以下内容：

| 可调整项 | 说明 |
|----------|------|
| 输出格式 | 添加/删除/修改摘要部分 |
| 提取数量 | 调整每个部分的最大条目数 |
| 语言风格 | 修改输出的语言和格式 |
| 提取规则 | 自定义信息提取的优先级和规则 |
| 特殊需求 | 添加项目特定的提取要求 |

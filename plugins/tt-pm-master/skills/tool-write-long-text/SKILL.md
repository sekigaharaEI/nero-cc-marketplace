---
description: 分块写入超长文本文件（超过8000字）。当需要创建长文档、生成大量内容、写入长篇文章、创建长代码文件时使用。避免因单次输出token限制导致的写入失败。
allowed-tools: Write, Edit, Read
---
# 长文本分块写入

## 适用场景

当需要写入的内容超过 3000 字（约 1500-2000 tokens）时使用此方法，避免因模型单次输出 token 限制导致写入失败。

## 核心策略

将长文本分成多个块，每块不超过 2500 字：
1. **第一块**：使用 Write 工具创建文件
2. **后续块**：使用 Edit 工具追加内容

## 操作步骤

### 步骤 1：规划分块

将完整内容按逻辑段落或章节划分，每块控制在 2000-2500 字以内。

### 步骤 2：创建文件（第一块）

使用 Write 工具创建文件并写入第一块内容：

```
Write 工具参数：
- file_path: 目标文件路径
- content: 第一块内容（不超过 2500 字）
```

### 步骤 3：追加后续内容

对于每个后续块，执行以下操作：

1. **读取文件末尾**：使用 Read 工具获取文件当前内容，记住最后 150-200 个字符

2. **使用 Edit 追加**：
   ```
   Edit 工具参数：
   - file_path: 目标文件路径
   - old_string: 文件末尾的 150-200 个字符（必须唯一）
   - new_string: old_string + 新追加的内容
   ```

3. **重复**：直到所有内容写入完成

### 步骤 4：验证完整性

使用 Read 工具读取完整文件，确认内容完整无误。

## 重要注意事项

1. **old_string 必须唯一**：选择文件末尾足够长的文本（150-200字符），确保在文件中只出现一次

2. **保持格式一致**：追加时注意换行符，确保段落衔接自然

3. **每块独立完整**：尽量在自然段落或章节边界分块，避免在句子中间断开

4. **预留余量**：每块控制在 2500 字以内，为工具调用的 JSON 结构预留空间

## 示例：写入一篇 6000 字的文章

假设要写入文件 `/path/to/article.md`，内容分为 3 块：

**第一步：创建文件，写入第 1 块（约 2000 字）**
```
使用 Write 工具：
- file_path: /path/to/article.md
- content: [第1块内容，包含标题和前两个章节]
```

**第二步：追加第 2 块（约 2000 字）**
```
1. 使用 Read 工具读取文件
2. 记录末尾 200 字符，例如："...这是第二章的结尾内容。\n\n"
3. 使用 Edit 工具：
   - old_string: "...这是第二章的结尾内容。\n\n"
   - new_string: "...这是第二章的结尾内容。\n\n## 第三章\n\n第三章的内容..."
```

**第三步：追加第 3 块（约 2000 字）**
```
重复上述追加流程
```

**第四步：验证**
```
使用 Read 工具确认完整内容
```

## 错误处理

如果 Edit 失败（old_string 不唯一）：
1. 重新 Read 文件
2. 选择更长或更独特的末尾文本作为 old_string
3. 重试 Edit 操作